/*! 
 Build based on gin-vue-admin 
 Time : 1715432289000 */
import{a as e,o as a,h as l,w as t,d as i,b as o,g as s,c as r,M as u,N as n,F as d,J as m,P as p,k as c,l as v,E as g,I as h,Y as y,e as b,dl as f,dm as B,dn as w,dp as I,dq as C,V as D,dr as E,ds as V}from"./087AC4D233B64EB0index.js";import{E as _}from"./087AC4D233B64EB0dialog.js";import"./087AC4D233B64EB0overlay.js";import{a as j,E as k}from"./087AC4D233B64EB0form-item.js";/* empty css                     */import{E as A}from"./087AC4D233B64EB0pagination.js";import"./087AC4D233B64EB0tag.js";import"./087AC4D233B64EB0select.js";import"./087AC4D233B64EB0scrollbar.js";/* empty css                      */import{E as N,a as x}from"./087AC4D233B64EB0table-column.js";import"./087AC4D233B64EB0checkbox.js";/* empty css                       */import{E as U}from"./087AC4D233B64EB0popover.js";import{E as z}from"./087AC4D233B64EB0switch.js";import{E as S}from"./087AC4D233B64EB0radio.js";/* empty css                      */import{g as O}from"./087AC4D233B64EB0authority2.js";import{g as P}from"./087AC4D233B64EB0institution2.js";import{C as q}from"./087AC4D233B64EB0index23.js";import{E as T}from"./087AC4D233B64EB0drawer.js";import{E as J}from"./087AC4D233B64EB0image-viewer.js";import{_ as F,U as K,a as M,g as R,e as $}from"./087AC4D233B64EB0common.js";import{_ as Y}from"./087AC4D233B64EB0warningBar.js";import{b as Z}from"./087AC4D233B64EB0bcrypt.js";import{m as G}from"./087AC4D233B64EB0md5.js";import"./087AC4D233B64EB0isUndefined.js";import"./087AC4D233B64EB0castArray.js";import"./087AC4D233B64EB0_baseClone.js";import"./087AC4D233B64EB0_Uint8Array.js";import"./087AC4D233B64EB0_initCloneObject.js";import"./087AC4D233B64EB0isEqual.js";import"./087AC4D233B64EB0index20.js";import"./087AC4D233B64EB0index21.js";import"./087AC4D233B64EB0strings.js";import"./087AC4D233B64EB0debounce.js";import"./087AC4D233B64EB0dropdown.js";import"./087AC4D233B64EB0arrays.js";import"./087AC4D233B64EB0cloneDeep.js";import"./087AC4D233B64EB0_plugin-vue_export-helper.js";import"./087AC4D233B64EB0upload2.js";import"./087AC4D233B64EB0progress.js";import"./087AC4D233B64EB0___vite-browser-external_commonjs-proxy.js";const H={encryptPassword:async e=>(console.log(e),await Z.hash(e,10)),comparePasswords:(e,a)=>Z.compareSync(e,a)},L={class:"gva-btn-list"},Q={class:"media"},W={class:"header-img-box-list"},X={class:"header-img-box-list"},ee=o("picture",null,null,-1),ae=["onClick"],le={__name:"index",props:{target:{type:Object,default:null},targetKey:{type:String,default:""}},emits:["enterImg"],setup(y,{expose:b,emit:f}){const B=e(""),w=e(""),I=e({}),C=e(1),D=e(0),E=e(20),V=e=>{E.value=e,z()},_=e=>{C.value=e,z()},N=f,x=e(!1),U=e([]),z=async()=>{const e=await R({page:C.value,pageSize:E.value,...I.value});0===e.code&&(U.value=e.data.list,D.value=e.data.total,C.value=e.data.page,E.value=e.data.pageSize,x.value=!0)};return b({open:z}),(e,b)=>{const f=v,S=j,O=g,P=k,q=h,R=J,Z=A,G=T;return a(),l(G,{modelValue:x.value,"onUpdate:modelValue":b[3]||(b[3]=e=>x.value=e),title:"媒体库",size:"650px"},{default:t((()=>[i(Y,{title:"点击“文件名/备注”可以编辑文件名或者备注内容。"}),o("div",L,[i(F,{imageCommon:w.value,"onUpdate:imageCommon":b[0]||(b[0]=e=>w.value=e),class:"upload-btn-media-library",onOnSuccess:z},null,8,["imageCommon"]),i(K,{imageUrl:B.value,"onUpdate:imageUrl":b[1]||(b[1]=e=>B.value=e),"file-size":512,"max-w-h":1080,class:"upload-btn-media-library",onOnSuccess:z},null,8,["imageUrl"]),i(P,{ref:"searchForm",inline:!0,model:I.value},{default:t((()=>[i(S,{label:""},{default:t((()=>[i(f,{modelValue:I.value.keyword,"onUpdate:modelValue":b[2]||(b[2]=e=>I.value.keyword=e),class:"keyword",placeholder:"请输入文件名或备注"},null,8,["modelValue"])])),_:1}),i(S,null,{default:t((()=>[i(O,{type:"primary",icon:"search",onClick:z},{default:t((()=>[s("查询")])),_:1})])),_:1})])),_:1},8,["model"])]),o("div",Q,[(a(!0),r(u,null,n(U.value,((e,s)=>(a(),r("div",{key:s,class:"media-box"},[o("div",W,[(a(),l(R,{key:s,src:d(M)(e.url),onClick:a=>{return l=e.url,t=y.target,i=y.targetKey,t&&i&&(t[i]=l),N("enterImg",l),void(x.value=!1);var l,t,i}},{error:t((()=>[o("div",X,[i(q,null,{default:t((()=>[ee])),_:1})])])),_:2},1032,["src","onClick"]))]),o("div",{class:"img-title",onClick:a=>(async e=>{p.prompt("请输入文件名或者备注","编辑",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/\S/,inputErrorMessage:"不能为空",inputValue:e.name}).then((async({value:a})=>{e.name=a,0===(await $(e)).code&&(c({type:"success",message:"编辑成功!"}),z())})).catch((()=>{c({type:"info",message:"取消修改"})}))})(e)},m(e.name),9,ae)])))),128))]),i(Z,{"current-page":C.value,"page-size":E.value,total:D.value,style:{"justify-content":"center"},layout:"total, prev, pager, next, jumper",onCurrentChange:_,onSizeChange:V},null,8,["current-page","page-size","total"])])),_:1},8,["modelValue"])}}},te={class:"gva-table-box"},ie={class:"gva-btn-list"},oe=o("p",null,"确定要删除此用户吗",-1),se={style:{"text-align":"right","margin-top":"8px"}},re={class:"gva-pagination"},ue={style:{height:"60vh",overflow:"auto",padding:"0 12px"}},ne=["src"],de={key:1,class:"header-img-box"},me={class:"dialog-footer"},pe=Object.assign({name:"User"},{__name:"user",setup(u){const n=e("/api/"),d=(e,a)=>{e&&e.forEach((e=>{if(e.children&&e.children.length){const l={authorityId:e.authorityId,authorityName:e.authorityName,children:[]};d(e.children,l.children),a.push(l)}else{const l={authorityId:e.authorityId,authorityName:e.authorityName};a.push(l)}}))},m=(e,a)=>{e&&e.forEach((e=>{if(e.children&&e.children.length){const l={institutionId:e.institutionId,institutionName:e.institutionName,children:[]};m(e.children,l.children),a.push(l)}else{const l={institutionId:e.institutionId,institutionName:e.institutionName};a.push(l)}}))},h=e(1),T=e(0),J=e(10),F=e([]),K=e=>{J.value=e,R()},M=e=>{h.value=e,R()},R=async()=>{const e=await f({page:h.value,pageSize:J.value});0===e.code&&(F.value=e.data.list,T.value=e.data.total,h.value=e.data.page,J.value=e.data.pageSize)};y((()=>F.value),(()=>{$()}));(async()=>{R();const e=await O({page:1,pageSize:999}),a=await P({page:1,pageSize:999});X(e.data.list,a.data.list)})();const $=()=>{F.value&&F.value.forEach((e=>{e.authorityIds=e.authorities&&e.authorities.map((e=>e.authorityId))}))},Z=e(null),L=()=>{Z.value.open()},Q=e([]),W=e([]),X=(e,a)=>{Q.value=[],W.value=[],d(e,Q.value),m(a,W.value)},ee=e({ID:0,userName:"",password:"",nickName:"",headerImg:"",authorityId:"",authorityIds:[],enable:1,institutionId:""}),ae=e({userName:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:2,message:"最低5位字符",trigger:"blur"}],password:[{required:!0,message:"请输入用户密码",trigger:"blur"},{min:6,message:"最低6位字符",trigger:"blur"}],nickName:[{message:"请输入用户昵称",trigger:"blur"}],phone:[{required:!0,pattern:/^1([38][0-9]|4[014-9]|[59][0-35-9]|6[2567]|7[0-8])\d{8}$/,message:"请输入合法手机号",trigger:"blur"}],email:[{pattern:/^([0-9A-Za-z\-_.]+)@([0-9a-z]+\.[a-z]{2,3}(\.[a-z]{2})?)$/g,message:"请输入正确的邮箱",trigger:"blur"}],authorityIds:[{required:!0,message:"请选择用户角色",trigger:"blur"}],institutionId:[{required:!0,message:"请选择用户所属机构",trigger:"blur"}]}),pe=e(null),ce=async()=>{var e={userName:ee.value.userName,password:ee.value.password,phone:ee.value.phone,nickName:ee.value.nickName,headerImg:ee.value.headerImg,authorityId:ee.value.authorityId,authorityIds:ee.value.authorityIds,enable:ee.value.enable,institutionId:ee.value.institutionId};e.password=G.md5(e.password),e.authorityId=e.authorityIds[0],pe.value.validate((async a=>{if(a){const a={...e};if("add"===he.value){0===(await I(a)).code&&(c({type:"success",message:"创建成功"}),await R(),ge())}if("edit"===he.value){a.ID=ee.value.ID,console.log(a);0===(await C(a)).code&&(c({type:"success",message:"编辑成功"}),await R(),ge())}}}))},ve=e(!1),ge=()=>{pe.value.resetFields(),ee.value.headerImg="",ee.value.authorityIds=[],ve.value=!1},he=e("add"),ye=()=>{ee.value={ID:0,userName:"",password:"",nickName:"",headerImg:"",authorityId:"",authorityIds:[],enable:1,institutionId:""},he.value="add",ve.value=!0},be={},fe=async(e,a,l)=>{if(a)return void(l||(be[e.ID]=[...e.authorityIds]));await D();0===(await E({ID:e.ID,authorityIds:e.authorityIds})).code?c({type:"success",message:"角色设置成功"}):l?e.authorityIds=[l,...e.authorityIds]:(e.authorityIds=[...be[e.ID]],delete be[e.ID])};return(e,u)=>{const d=g,m=N,y=S,f=z,I=U,E=x,O=A,P=v,$=j,G=k,X=_;return a(),r("div",null,[i(Y,{title:"注：右上角头像下拉可切换角色"}),o("div",te,[o("div",ie,[i(d,{type:"primary",icon:"plus",onClick:ye},{default:t((()=>[s("新增用户")])),_:1})]),i(E,{data:F.value,"row-key":"ID"},{default:t((()=>[i(m,{align:"left",label:"头像","min-width":"75"},{default:t((e=>[i(q,{style:{"margin-top":"8px"},"pic-src":e.row.headerImg},null,8,["pic-src"])])),_:1}),i(m,{align:"left",label:"ID","min-width":"50",prop:"ID"}),i(m,{align:"left",label:"用户名","min-width":"150",prop:"userName"}),i(m,{align:"left",label:"昵称","min-width":"150",prop:"nickName"}),i(m,{align:"left",label:"手机号","min-width":"180",prop:"phone"}),i(m,{align:"left",label:"邮箱","min-width":"180",prop:"email"}),i(m,{align:"left",label:"用户角色","min-width":"200"},{default:t((e=>[i(y,{modelValue:e.row.authorityIds,"onUpdate:modelValue":a=>e.row.authorityIds=a,options:Q.value,"show-all-levels":!1,"collapse-tags":"",props:{multiple:!0,checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},clearable:!1,onVisibleChange:a=>{fe(e.row,a,0)},onRemoveTag:a=>{fe(e.row,!1,a)}},null,8,["modelValue","onUpdate:modelValue","options","onVisibleChange","onRemoveTag"])])),_:1}),i(m,{align:"left",label:"所属机构","min-width":"200"},{default:t((e=>[i(y,{modelValue:e.row.institutionId,"onUpdate:modelValue":a=>e.row.institutionId=a,options:W.value,"show-all-levels":!1,"collapse-tags":"",props:{label:"institutionName",value:"institutionId",disabled:"disabled",emitPath:!1},clearable:!1,onVisibleChange:a=>{(async(e,a)=>{if(a)return;await D(),0===(await V({institutionId:e.institutionId})).code?c({type:"success",message:"机构设置成功"}):c({type:"error",message:"机构设置失败"})})(e.row,a)}},null,8,["modelValue","onUpdate:modelValue","options","onVisibleChange"])])),_:1}),i(m,{align:"left",label:"启用","min-width":"150"},{default:t((e=>[i(f,{modelValue:e.row.enable,"onUpdate:modelValue":a=>e.row.enable=a,"inline-prompt":"","active-value":1,"inactive-value":2,onChange:()=>{(async e=>{ee.value=JSON.parse(JSON.stringify(e)),await D();const a={...ee.value};0===(await C(a)).code&&(c({type:"success",message:"".concat(2===a.enable?"禁用":"启用","成功")}),await R(),ee.value.headerImg="",ee.value.authorityIds=[])})(e.row)}},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1}),i(m,{label:"操作","min-width":"250",fixed:"right"},{default:t((e=>[i(I,{visible:e.row.visible,"onUpdate:visible":a=>e.row.visible=a,placement:"top",width:"160"},{reference:t((()=>[i(d,{type:"primary",link:"",icon:"delete"},{default:t((()=>[s("删除")])),_:1})])),default:t((()=>[oe,o("div",se,[i(d,{type:"primary",link:"",onClick:a=>e.row.visible=!1},{default:t((()=>[s("取消")])),_:2},1032,["onClick"]),i(d,{type:"primary",onClick:a=>(async e=>{0===(await w({id:e.ID})).code&&(c.success("删除成功"),e.visible=!1,await R())})(e.row)},{default:t((()=>[s("确定")])),_:2},1032,["onClick"])])])),_:2},1032,["visible","onUpdate:visible"]),i(d,{type:"primary",link:"",icon:"edit",onClick:a=>{return l=e.row,he.value="edit",ee.value=JSON.parse(JSON.stringify(l)),void(ve.value=!0);var l}},{default:t((()=>[s("编辑")])),_:2},1032,["onClick"]),i(d,{type:"primary",link:"",icon:"magic-stick",onClick:a=>{return l=e.row,void p.confirm("是否将此用户密码重置为Aa123456?","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{var e=H.encryptPassword("Aa123456");const a=await B({ID:l.ID,password:e});0===a.code?c({type:"success",message:a.msg}):c({type:"error",message:a.msg})}));var l}},{default:t((()=>[s("重置密码")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),o("div",re,[i(O,{"current-page":h.value,"page-size":J.value,"page-sizes":[10,30,50,100],total:T.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:M,onSizeChange:K},null,8,["current-page","page-size","total"])])]),i(X,{modelValue:ve.value,"onUpdate:modelValue":u[8]||(u[8]=e=>ve.value=e),title:"用户","show-close":!1,"close-on-press-escape":!1,"close-on-click-modal":!1},{footer:t((()=>[o("div",me,[i(d,{onClick:ge},{default:t((()=>[s("取 消")])),_:1}),i(d,{type:"primary",onClick:ce},{default:t((()=>[s("确 定")])),_:1})])])),default:t((()=>[o("div",ue,[i(G,{ref_key:"userForm",ref:pe,rules:ae.value,model:ee.value,"label-width":"80px"},{default:t((()=>["add"===he.value?(a(),l($,{key:0,label:"用户名",prop:"userName"},{default:t((()=>[i(P,{modelValue:ee.value.userName,"onUpdate:modelValue":u[0]||(u[0]=e=>ee.value.userName=e)},null,8,["modelValue"])])),_:1})):b("",!0),"add"===he.value?(a(),l($,{key:1,label:"密码",prop:"password"},{default:t((()=>[i(P,{modelValue:ee.value.password,"onUpdate:modelValue":u[1]||(u[1]=e=>ee.value.password=e)},null,8,["modelValue"])])),_:1})):b("",!0),i($,{label:"昵称",prop:"nickName"},{default:t((()=>[i(P,{modelValue:ee.value.nickName,"onUpdate:modelValue":u[2]||(u[2]=e=>ee.value.nickName=e)},null,8,["modelValue"])])),_:1}),i($,{label:"手机号",prop:"phone"},{default:t((()=>[i(P,{modelValue:ee.value.phone,"onUpdate:modelValue":u[3]||(u[3]=e=>ee.value.phone=e)},null,8,["modelValue"])])),_:1}),i($,{label:"邮箱",prop:"email"},{default:t((()=>[i(P,{modelValue:ee.value.email,"onUpdate:modelValue":u[4]||(u[4]=e=>ee.value.email=e)},null,8,["modelValue"])])),_:1}),i($,{label:"用户角色",prop:"authorityIds"},{default:t((()=>[i(y,{modelValue:ee.value.authorityIds,"onUpdate:modelValue":u[5]||(u[5]=e=>ee.value.authorityIds=e),style:{width:"100%"},options:Q.value,"show-all-levels":!1,props:{multiple:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},clearable:!1},null,8,["modelValue","options"])])),_:1}),i($,{label:"用户所属机构",prop:"institutionId"},{default:t((()=>[i(y,{modelValue:ee.value.institutionId,"onUpdate:modelValue":u[6]||(u[6]=e=>ee.value.institutionId=e),style:{width:"100%"},options:W.value,"show-all-levels":!1,props:{label:"institutionName",value:"institutionId",disabled:"disabled",emitPath:!1},clearable:!1},null,8,["modelValue","options"])])),_:1}),i($,{label:"启用",prop:"disabled"},{default:t((()=>[i(f,{modelValue:ee.value.enable,"onUpdate:modelValue":u[7]||(u[7]=e=>ee.value.enable=e),"inline-prompt":"","active-value":1,"inactive-value":2},null,8,["modelValue"])])),_:1}),i($,{label:"头像","label-width":"80px"},{default:t((()=>[o("div",{style:{display:"inline-block"},onClick:L},[ee.value.headerImg?(a(),r("img",{key:0,alt:"头像",class:"header-img-box",src:ee.value.headerImg&&"http"!==ee.value.headerImg.slice(0,4)?n.value+ee.value.headerImg:ee.value.headerImg},null,8,ne)):(a(),r("div",de,"从媒体库选择"))])])),_:1})])),_:1},8,["rules","model"])])])),_:1},8,["modelValue"]),i(le,{ref_key:"chooseImg",ref:Z,target:ee.value,"target-key":"headerImg"},null,8,["target"])])}}});export{pe as default};
