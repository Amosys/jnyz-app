/*! 
 Build based on gin-vue-admin 
 Time : 1715432289000 */
import{a as t,o as e,c as i,b as a,d as l,w as n,g as s,F as o,c_ as u,P as d,k as r,E as m,I as p,l as c}from"./087AC4D233B64EB0index.js";import{E as v}from"./087AC4D233B64EB0dialog.js";import"./087AC4D233B64EB0overlay.js";import{a as B,E as f}from"./087AC4D233B64EB0form-item.js";/* empty css                     */import{E as C}from"./087AC4D233B64EB0radio.js";/* empty css                      */import"./087AC4D233B64EB0tag.js";import"./087AC4D233B64EB0checkbox.js";import"./087AC4D233B64EB0scrollbar.js";import{E as I,a as b}from"./087AC4D233B64EB0table-column.js";/* empty css                       *//* empty css                      */import{g,d as E,u as h,c as D}from"./087AC4D233B64EB0institution2.js";import{t as j}from"./087AC4D233B64EB0doc.js";import"./087AC4D233B64EB0isUndefined.js";import"./087AC4D233B64EB0castArray.js";import"./087AC4D233B64EB0_baseClone.js";import"./087AC4D233B64EB0_Uint8Array.js";import"./087AC4D233B64EB0_initCloneObject.js";import"./087AC4D233B64EB0strings.js";import"./087AC4D233B64EB0isEqual.js";import"./087AC4D233B64EB0arrays.js";import"./087AC4D233B64EB0cloneDeep.js";import"./087AC4D233B64EB0index20.js";import"./087AC4D233B64EB0index21.js";import"./087AC4D233B64EB0debounce.js";const A={class:"institution"},y={class:"gva-table-box"},w={class:"gva-btn-list"},_={class:"dialog-footer"},k=Object.assign({name:"Institution"},{__name:"institution",setup(k){const N=t([{institutionId:0,institutionName:"根机构"}]);t(!1);const V=t("add");t({});const x=t("新增机构"),U=t(!1),q=t(!1);t({});const S=t({institutionId:0,institutionName:"",parentId:0}),F=t({institutionId:[{required:!0,message:"请输入机构ID",trigger:"blur"},{validator:(t,e,i)=>/^[0-9]*[1-9][0-9]*$/.test(e)?i():i(new Error("请输入正整数")),trigger:"blur",message:"必须为正整数"}],institutionName:[{required:!0,message:"请输入机构名称",trigger:"blur"}],parentId:[{required:!0,message:"请选择父机构",trigger:"blur"}]}),T=t(1),z=t(0),O=t(999),P=t([]),$=t({}),G=async()=>{const t=await g({page:T.value,pageSize:O.value,...$.value});console.log(t),0===t.code&&(P.value=t.data.list,z.value=t.data.total,T.value=t.data.page,O.value=t.data.pageSize)};G(),t(null),t(null),t(null);const H=t(null),J=()=>{H.value&&H.value.resetFields(),S.value={institutionId:0,institutionName:"",parentId:0}},K=()=>{J(),U.value=!1,q.value=!1},L=()=>{H.value.validate((async t=>{if(t){switch(S.value.institutionId=Number(S.value.institutionId),V.value){case"add":0===(await D(S.value)).code&&(r({type:"success",message:"添加成功!"}),G(),K());break;case"edit":0===(await h(S.value)).code&&(r({type:"success",message:"添加成功!"}),G(),K())}J(),U.value=!1}}))},M=()=>{N.value=[{institutionId:0,institutionName:"根机构"}],Q(P.value,N.value,!1)},Q=(t,e,i)=>{S.value.institutionId=String(S.value.institutionId),t&&t.forEach((t=>{if(t.children&&t.children.length){const a={institutionId:t.institutionId,institutionName:t.institutionName,disabled:i||t.institutionId===S.value.institutionId,children:[]};Q(t.children,a.children,i||t.institutionId===S.value.institutionId),e.push(a)}else{const a={institutionId:t.institutionId,institutionName:t.institutionName,disabled:i||t.institutionId===S.value.institutionId};e.push(a)}}))},R=t=>{J(),x.value="新增机构",V.value="add",S.value.parentId=t,M(),U.value=!0};return(t,g)=>{const h=m,D=p,k=I,q=b,z=C,O=B,$=c,J=f,Q=v;return e(),i("div",A,[a("div",y,[a("div",w,[l(h,{type:"primary",icon:"plus",onClick:g[0]||(g[0]=t=>R(0))},{default:n((()=>[s("新增机构")])),_:1}),l(D,{class:"cursor-pointer",onClick:g[1]||(g[1]=t=>o(j)("https://www.bilibili.com/video/BV1kv4y1g7nT?p=8&vd_source=f2640257c21e3b547a790461ed94875e"))},{default:n((()=>[l(o(u))])),_:1})]),l(q,{data:P.value,"tree-props":{children:"children",hasChildren:"hasChildren"},"row-key":"institutionId",style:{width:"100%"}},{default:n((()=>[l(k,{label:"机构ID","min-width":"180",prop:"institutionId"}),l(k,{align:"left",label:"机构名称","min-width":"180",prop:"institutionName"}),l(k,{align:"left",label:"操作",width:"460"},{default:n((t=>[l(h,{icon:"plus",type:"primary",link:"",onClick:e=>R(t.row.institutionId)},{default:n((()=>[s("新增子机构")])),_:2},1032,["onClick"]),l(h,{icon:"edit",type:"primary",link:"",onClick:e=>(t=>{M(),x.value="编辑机构",V.value="edit";for(const e in S.value)S.value[e]=t[e];M(),U.value=!0})(t.row)},{default:n((()=>[s("编辑")])),_:2},1032,["onClick"]),l(h,{icon:"delete",type:"primary",link:"",onClick:e=>{return i=t.row,void d.confirm("此操作将永久删除该机构, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await E({institutionId:i.institutionId})).code&&(r({type:"success",message:"删除成功!"}),1===P.value.length&&T.value>1&&T.value--,G())})).catch((()=>{r({type:"info",message:"已取消删除"})}));var i}},{default:n((()=>[s("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])]),l(Q,{modelValue:U.value,"onUpdate:modelValue":g[5]||(g[5]=t=>U.value=t),title:x.value},{footer:n((()=>[a("div",_,[l(h,{onClick:K},{default:n((()=>[s("取 消")])),_:1}),l(h,{type:"primary",onClick:L},{default:n((()=>[s("确 定")])),_:1})])])),default:n((()=>[l(J,{ref_key:"institutionForm",ref:H,model:S.value,rules:F.value,"label-width":"80px"},{default:n((()=>[l(O,{label:"父级机构",prop:"parentId"},{default:n((()=>[l(z,{modelValue:S.value.parentId,"onUpdate:modelValue":g[2]||(g[2]=t=>S.value.parentId=t),style:{width:"100%"},disabled:"add"===V.value,options:N.value,props:{checkStrictly:!0,label:"institutionName",value:"institutionId",disabled:"disabled",emitPath:!1},"show-all-levels":!1,filterable:""},null,8,["modelValue","disabled","options"])])),_:1}),l(O,{label:"机构ID",prop:"institutionId"},{default:n((()=>[l($,{modelValue:S.value.institutionId,"onUpdate:modelValue":g[3]||(g[3]=t=>S.value.institutionId=t),disabled:"edit"===V.value,autocomplete:"off",maxlength:"15"},null,8,["modelValue","disabled"])])),_:1}),l(O,{label:"机构名称",prop:"institutionName"},{default:n((()=>[l($,{modelValue:S.value.institutionName,"onUpdate:modelValue":g[4]||(g[4]=t=>S.value.institutionName=t),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])}}});export{k as default};
